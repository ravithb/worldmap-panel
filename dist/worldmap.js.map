{"version":3,"sources":["../src/worldmap.js"],"names":["_","L","antPath","Colors","tileServers","url","attribution","subdomains","WorldMap","ctrl","mapContainer","onMove","moveEvent","target","setBoundsOnFirstLoad","onBoundsChange","flattenBounds","getBounds","bind","onZoom","zoomEvent","onResize","resizeEvent","circles","lineCoords","extraLineLayers","markerLayers","geoJsonLayers","geoJsonBounds","linesLayer","lineColor","first","panel","colors","drawTrail","showTrail","antPathDelay","useCustomAntPathColor","customAntPathColor","antPathColor","antPathPulseColor","extraLineColors","extraLineSecondaryColors","lastBounds","showAsAntPath","createMap","window","Icon","Default","imagePath","mapCenter","latLng","parseFloat","mapCenterLatitude","mapCenterLongitude","map","worldCopyJump","center","zoom","parseInt","initialZoom","setMouseWheelZoom","selectedTileServer","tileServer","tileLayer","maxZoom","reuseTiles","detectRetina","addTo","on","legend","control","position","onAdd","_div","DomUtil","create","update","data","length","thresholds","legendHtml","index","innerHTML","locations","sort","dataPoints","isEqual","filter","o","hideEmpty","isNil","value","hideZero","circlesLayer","clearLayers","removeCircles","feature","layer","properties","geoJsonOptions","popupContentField","bindPopup","self","forEach","dataObj","geoJson","geoJsonObj","JSON","parse","geoJsonLayer","geoJSON","onEachFeature","onEachGeoJsonFeature","extend","fitBounds","push","filterEmptyAndZeroValues","needToRedrawCircles","clearCircles","createCircles","clearPolyLine","drawExtraLines","updateCircles","getContainer","focus","dataPoint","locationName","c","createCircle","getColor","getLatLng","lat","lng","addCircles","removeLines","getPopup","unbindPopup","dataset","resultArr","locationLatitude","locationLongitude","marker","title","draggable","popup","setContent","evt","isPopupOpen","openPopup","dataIdx","random","secondaryLineColor","polyline","toCoords","color","drawMarkers","circle","find","cir","options","location","key","setRadius","calcCircleSize","setStyle","fillColor","fillOpacity","createPopup","valueRounded","circleMarker","radius","urlFollowOptions","openInNewWindow","name","specs","useHeadlessWindow","open","replace","label","unit","unitSingular","unitPlural","trim","dataPointValue","circleMinSize","circleMaxSize","valueRange","dataFactor","lowestValue","circleSizeRange","point","stickyLabels","onMouseOver","bringToFront","onMouseOut","closePopup","invalidateSize","panTo","mapCenterMoved","remove","mouseWheelZoom","scrollWheelZoom","disable","enable","layerGroup","removeLayer","flag","delay","useCustomColor","pulseColor","color1","color2","pathColor1","pathColor2","zoomFactor","setZoom","removeLegend","bounds","trigger","maxChangeDelta","calculateMaxChangeDelta","nortWest","getNorthWest","northEast","getNorthEast","southEast","getSouthEast","southWest","getSouthWest","triggeredBy","nwDist","CRS","Simple","distance","neDist","seDist","swDist"],"mappings":"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","file":"worldmap.js","sourcesContent":["import _ from 'lodash';\n/* eslint-disable id-length, no-unused-vars */\nimport L from './libs/leaflet';\n/* eslint-disable id-length, no-unused-vars */\nimport {antPath} from './libs/leaflet-ant-path';\n/* eslint class-methods-use-this: [\"error\", { \"exceptMethods\": [\"toCoords\",\"flattenBounds\",\"onEachGeoJsonFeature\"] }] */\n/* eslint-disable no-extra-bind */\nimport Colors from './colors';\n\n\nconst tileServers = {\n  'CartoDB Positron': {\n    url: 'https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png',\n    attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>',\n    subdomains: 'abcd'\n  },\n  'CartoDB Dark': {\n    url: 'https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png',\n    attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>',\n    subdomains: 'abcd'\n  },\n  'Open Street Maps': {\n    url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\n    attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\n    subdomains: 'abc'\n  },\n  'Stamen Maps': {\n    url: 'http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png',\n    attribution: 'Map tiles by <a href=\"http://stamen.com\">Stamen Design</a>, under <a href=\"http://creativecommons.org/licenses/by/3.0\">CC BY 3.0</a>. Data by <a href=\"http://openstreetmap.org\">OpenStreetMap</a>, under <a href=\"http://www.openstreetmap.org/copyright\">ODbL</a>.',\n    subdomains: 'abc'\n\n  }\n};\n\nexport default class WorldMap {\n  constructor(ctrl, mapContainer) {\n    this.ctrl = ctrl;\n    this.mapContainer = mapContainer;\n    this.circles = [];\n    this.lineCoords = [];\n    this.extraLineLayers = [];\n    this.markerLayers = [];\n    this.geoJsonLayers = [];\n    this.geoJsonBounds = null;\n    this.linesLayer = null;\n    this.lineColor = _.first(this.ctrl.panel.colors);\n    this.drawTrail = this.ctrl.panel.showTrail;\n    this.antPathDelay = this.ctrl.panel.antPathDelay;\n    this.useCustomAntPathColor = this.ctrl.panel.customAntPathColor;\n    this.antPathColor = this.ctrl.panel.antPathColor;\n    this.antPathPulseColor = this.ctrl.panel.antPathPulseColor;\n    this.extraLineColors = this.ctrl.panel.extraLineColors;\n    this.extraLineSecondaryColors = this.ctrl.panel.extraLineSecondaryColors;\n    this.lastBounds = null;\n    this.showAsAntPath = true;\n    this.setBoundsOnFirstLoad = true;\n    return this.createMap();\n  }\n\n  createMap() {\n    window.L.Icon.Default.imagePath = 'public/plugins/grafana-custom-worldmap-panel/images/';\n    const mapCenter = window.L.latLng(parseFloat(this.ctrl.panel.mapCenterLatitude), parseFloat(this.ctrl.panel.mapCenterLongitude));\n    this.map = window.L.map(this.mapContainer, { worldCopyJump: true, center: mapCenter, zoom: parseInt(this.ctrl.panel.initialZoom, 10) || 1 });\n    this.setMouseWheelZoom();\n\n    const selectedTileServer = tileServers[this.ctrl.tileServer];\n    window.L.tileLayer(selectedTileServer.url, {\n      maxZoom: 18,\n      subdomains: selectedTileServer.subdomains,\n      reuseTiles: true,\n      detectRetina: true,\n      attribution: selectedTileServer.attribution\n    }).addTo(this.map);\n\n    this.map.on('zoomend', this.onZoom);\n    this.map.on('moveend', this.onZoom);\n    this.map.on('resize', this.onResize);\n  }\n\n  createLegend() {\n    this.legend = window.L.control({position: 'bottomleft'});\n    this.legend.onAdd = () => {\n      this.legend._div = window.L.DomUtil.create('div', 'info legend');\n      this.legend.update();\n      return this.legend._div;\n    };\n\n    this.legend.update = () => {\n      if (!this.ctrl.data || this.ctrl.data.length === 0) {\n        return;\n      }\n      const thresholds = this.ctrl.data[0].thresholds;\n      let legendHtml = '';\n      legendHtml += '<div class=\"legend-item\"><i style=\"background:' + this.ctrl.panel.colors[0] + '\"></i> ' +\n          '&lt; ' + thresholds[0] + '</div>';\n      for (let index = 0; index < thresholds.length; index += 1) {\n        legendHtml +=\n          '<div class=\"legend-item\"><i style=\"background:' + this.ctrl.panel.colors[index + 1] + '\"></i> ' +\n          thresholds[index] + (thresholds[index + 1] ? '&ndash;' + thresholds[index + 1] + '</div>' : '+');\n      }\n      this.legend._div.innerHTML = legendHtml;\n    };\n    this.legend.addTo(this.map);\n  }\n\n  needToRedrawCircles(data) {\n    if (this.circles.length === 0 && data.length > 0) return true;\n\n    if (this.circles.length !== data.length) return true;\n    const locations = _.map(_.map(this.circles, 'options'), 'location').sort();\n    const dataPoints = _.map(data, 'key').sort();\n    return !_.isEqual(locations, dataPoints);\n  }\n\n  filterEmptyAndZeroValues(data) {\n    return _.filter(data, (o) => { return !(this.ctrl.panel.hideEmpty && _.isNil(o.value)) && !(this.ctrl.panel.hideZero && o.value === 0); });\n  }\n\n  clearCircles() {\n    if (this.circlesLayer) {\n      this.circlesLayer.clearLayers();\n      this.removeCircles(this.circlesLayer);\n      this.circles = [];\n    }\n  }\n\n  onEachGeoJsonFeature(feature, layer) {\n    // console.log('Feature %o', feature);\n    if (!this.ctrl.panel) {\n      return;\n    }\n\n    if (feature.properties[this.ctrl.panel.geoJsonOptions.popupContentField]) {\n      layer.bindPopup(feature.properties[this.ctrl.panel.geoJsonOptions.popupContentField]);\n    }\n  }\n\n  drawGeoJson() {\n    const self = this;\n    const data = this.ctrl.data;\n    if (!data || !data.length) {\n      return;\n    }\n    data.forEach((dataObj) => {\n      if (!dataObj || !dataObj.geoJson) {\n        return;\n      }\n      const geoJsonObj = JSON.parse(dataObj.geoJson);\n      const geoJsonLayer = window.L.geoJSON(geoJsonObj, {\n        onEachFeature: self.onEachGeoJsonFeature.bind(self)\n      }).addTo(this.map);\n\n      if (!this.geoJsonBounds) {\n        this.geoJsonBounds = geoJsonLayer.getBounds();\n      } else {\n        this.geoJsonBounds.extend(geoJsonLayer.getBounds());\n      }\n      if (this.geoJsonBounds && this.setBoundsOnFirstLoad) {\n        this.map.fitBounds(this.geoJsonBounds);\n      }\n\n      this.geoJsonLayers.push(geoJsonLayer);\n    });\n  }\n\n  drawCircles() {\n    const data = this.filterEmptyAndZeroValues(this.ctrl.data[0]);\n\n    if (this.needToRedrawCircles(data)) {\n      this.clearCircles();\n      this.createCircles(data);\n      this.clearPolyLine();\n      if (this.drawTrail) {\n        const extraLineLayers = this.drawExtraLines();\n      }\n    } else {\n      this.updateCircles(data);\n    }\n  }\n\n  focus() {\n    if (this.map) {\n      this.map.getContainer().focus();\n    }\n  }\n\n  createCircles(data) {\n    const circles = [];\n    data.forEach((dataPoint) => {\n      if (!dataPoint.locationName) return;\n      const c = this.createCircle(dataPoint);\n      this.lineColor = this.getColor(dataPoint.value);\n      if (this.drawTrail) {\n        this.lineCoords.push([c.getLatLng().lat, c.getLatLng().lng]);\n      }\n      circles.push(c);\n    });\n    this.circlesLayer = this.addCircles(circles);\n    this.circles = circles;\n  }\n\n  clearPolyLine() {\n    if (this.linesLayer) {\n      this.removeLines(this.linesLayer);\n    }\n    if (this.extraLineLayers) {\n      this.extraLineLayers.forEach((layer) => {\n        this.removeLines(layer);\n      });\n    }\n    if (this.markerLayers) {\n      this.markerLayers.forEach((layer) => {\n        if (layer.getPopup()) {\n          layer.unbindPopup();\n        }\n        this.removeLines(layer);\n      });\n    }\n  }\n\n  toCoords(dataset) {\n    const resultArr = [];\n\n    dataset.forEach((dataPoint) => {\n      resultArr.push([dataPoint.locationLatitude, dataPoint.locationLongitude]);\n    });\n\n    return resultArr;\n  }\n\n  drawMarkers(dataset) {\n    const self = this;\n    dataset.forEach((dataPoint) => {\n      if (dataPoint.marker) {\n        const marker = window.L.marker([dataPoint.locationLatitude, dataPoint.locationLongitude], {\n          title: dataPoint.marker,\n          draggable: false,\n        }).addTo(this.map);\n        const popup = window.L.popup().setContent('<b style=\"color: #666666\">' + dataPoint.marker + '</b>');\n        marker.bindPopup(popup);\n        marker.on('click', (evt) => {\n          if (marker.isPopupOpen() === false) {\n            marker.openPopup();\n          }\n        });\n        marker.on('mouseover', (evt) => {\n          if (marker.isPopupOpen() === false) {\n            marker.openPopup();\n          }\n        });\n\n        self.markerLayers.push(marker);\n      }\n    });\n    return this.markerLayers;\n  }\n\n  drawExtraLines() {\n    const self = this;\n    if (!this.ctrl.data || this.ctrl.data.length < 1) {\n      return;\n    }\n\n    for (let dataIdx = 1; dataIdx < this.ctrl.data.length; dataIdx += 1) {\n      const lineColor = (this.extraLineColors && this.extraLineColors.length >= dataIdx)\n        ? this.extraLineColors[dataIdx - 1] : Colors.random();\n      const secondaryLineColor = (this.extraLineSecondaryColors && this.extraLineSecondaryColors.length >= dataIdx)\n        ? this.extraLineSecondaryColors[dataIdx - 1] : Colors.random();\n      let layer = null;\n\n      if (this.showAsAntPath) {\n        layer = window.L.polyline.antPath(self.toCoords(this.ctrl.data[dataIdx]), {\n          'delay': this.antPathDelay,\n          'dashArray': [10, 20],\n          'weight': 5,\n          'color': lineColor,\n          'pulseColor': (this.useCustomAntPathColor ? secondaryLineColor : '#FFFFFF'),\n          'paused': false,\n          'reverse': false\n        }).addTo(this.map);\n      } else {\n        layer = window.L.polyline(self.toCoords(this.ctrl.data[dataIdx]), {\n          color: lineColor\n        }).addTo(this.map);\n      }\n      this.extraLineLayers.push(layer);\n      self.drawMarkers(this.ctrl.data[dataIdx]);\n    }\n    return this.extraLineLayers;\n  }\n\n  drawPolyLine() {\n    if (this.showAsAntPath) {\n      this.linesLayer = window.L.polyline.antPath(this.lineCoords, {\n        'delay': this.antPathDelay,\n        'dashArray': [10, 20],\n        'weight': 5,\n        'color': (this.useCustomAntPathColor ? this.antPathColor : this.lineColor),\n        'pulseColor': (this.useCustomAntPathColor ? this.antPathPulseColor : '#FFFFFF'),\n        'paused': false,\n        'reverse': false\n      }).addTo(this.map);\n    } else {\n      this.linesLayer = window.L.polyline(this.lineCoords, {\n        color: this.lineColor\n      }).addTo(this.map);\n    }\n    return this.linesLayer;\n  }\n\n  updateCircles(data) {\n    data.forEach((dataPoint) => {\n      if (!dataPoint.locationName) return;\n\n      const circle = _.find(this.circles, (cir) => { return cir.options.location === dataPoint.key; });\n\n      if (circle) {\n        circle.setRadius(this.calcCircleSize(dataPoint.value || 0));\n        circle.setStyle({\n          color: this.getColor(dataPoint.value),\n          fillColor: this.getColor(dataPoint.value),\n          fillOpacity: 0.5,\n          location: dataPoint.key,\n        });\n        circle.unbindPopup();\n        this.createPopup(circle, dataPoint.locationName, dataPoint.valueRounded);\n      }\n    });\n  }\n\n  createCircle(dataPoint) {\n    const circle = window.L.circleMarker([dataPoint.locationLatitude, dataPoint.locationLongitude], {\n      radius: this.calcCircleSize(dataPoint.value || 0),\n      color: this.getColor(dataPoint.value),\n      fillColor: this.getColor(dataPoint.value),\n      fillOpacity: 0.5,\n      location: dataPoint.key\n    });\n    if (dataPoint.url) {\n      if (this.ctrl.panel.urlFollowOptions.openInNewWindow) {\n        const name = '_blank';\n        let specs = '';\n        if (this.ctrl.panel.urlFollowOptions.useHeadlessWindow) {\n          specs = 'menubar=0,resizable=1,location=0,titlebar=0,toolbar=0';\n        }\n        circle.on('click', () => { window.open(dataPoint.url, name, specs); });\n      } else {\n        circle.on('click', () => { window.location.replace(dataPoint.url); });\n      }\n    }\n\n    const value = dataPoint.valueRounded;\n    let label = '';\n    if (dataPoint.label) {\n      label = dataPoint.label;\n    } else {\n      const unit = value && value === 1 ? this.ctrl.panel.unitSingular : this.ctrl.panel.unitPlural;\n      label = (dataPoint.locationName + ': ' + value + ' ' + (unit || '')).trim();\n    }\n    this.createPopup(circle, label);\n    return circle;\n  }\n\n  calcCircleSize(dataPointValue) {\n    const circleMinSize = parseInt(this.ctrl.panel.circleMinSize, 10) || 2;\n    const circleMaxSize = parseInt(this.ctrl.panel.circleMaxSize, 10) || 30;\n\n    if (this.ctrl.data[0].valueRange === 0) {\n      return circleMaxSize;\n    }\n\n    const dataFactor = (dataPointValue - this.ctrl.data[0].lowestValue) / this.ctrl.data[0].valueRange;\n    const circleSizeRange = circleMaxSize - circleMinSize;\n\n    return (circleSizeRange * dataFactor) + circleMinSize;\n  }\n\n  createPopup(circle, label) {\n    circle.bindPopup(label, {'offset': window.L.point(0, -2), 'className': 'worldmap-popup', 'closeButton': this.ctrl.panel.stickyLabels});\n\n    circle.on('mouseover', function onMouseOver(evt) {\n      const layer = evt.target;\n      layer.bringToFront();\n      this.openPopup();\n    });\n\n    if (!this.ctrl.panel.stickyLabels) {\n      circle.on('mouseout', function onMouseOut() {\n        circle.closePopup();\n      });\n    }\n  }\n\n  getColor(value) {\n    for (let index = this.ctrl.data[0].thresholds.length; index > 0; index -= 1) {\n      if (value >= this.ctrl.data[0].thresholds[index - 1]) {\n        return this.ctrl.panel.colors[index];\n      }\n    }\n    return _.first(this.ctrl.panel.colors);\n  }\n\n  resize() {\n    this.map.invalidateSize();\n  }\n\n  panToMapCenter() {\n    this.map.panTo([parseFloat(this.ctrl.panel.mapCenterLatitude), parseFloat(this.ctrl.panel.mapCenterLongitude)]);\n    this.ctrl.mapCenterMoved = false;\n  }\n\n  removeLegend() {\n    this.legend.remove(this.map);\n    this.legend = null;\n  }\n\n  setMouseWheelZoom() {\n    if (!this.ctrl.panel.mouseWheelZoom) {\n      this.map.scrollWheelZoom.disable();\n    } else {\n      this.map.scrollWheelZoom.enable();\n    }\n  }\n\n  addCircles(circles) {\n    return window.L.layerGroup(circles).addTo(this.map);\n  }\n\n  removeCircles() {\n    this.map.removeLayer(this.circlesLayer);\n  }\n\n  removeLines(layer) {\n    this.map.removeLayer(layer);\n  }\n\n  showTrail(flag) {\n    this.drawTrail = flag;\n    if (!this.drawTrail) {\n      this.clearPolyLine();\n    }\n  }\n\n  setAntPathOptions(delay, useCustomColor, color, pulseColor) {\n    this.useCustomAntPathColor = useCustomColor;\n    this.antPathDelay = delay;\n    this.antPathColor = color;\n    this.antPathPulseColor = pulseColor;\n  }\n\n  setPathColors(color1, color2) {\n    this.pathColor1 = color1;\n    this.pathColor2 = color2;\n  }\n\n  setExtraLineColors(colors) {\n    this.extraLineColors = colors;\n  }\n\n  setExtraLineSecondaryColors(colors) {\n    this.extraLineSecondaryColors = colors;\n  }\n\n  setShowAsAntPath(flag) {\n    this.showAsAntPath = flag;\n  }\n\n  setZoom(zoomFactor) {\n    this.map.setZoom(parseInt(zoomFactor, 10));\n  }\n\n  remove() {\n    this.circles = [];\n    if (this.circlesLayer) this.removeCircles();\n    if (this.legend) this.removeLegend();\n    this.map.remove();\n  }\n\n  onMove = ((moveEvent) => {\n    if (!moveEvent.target) {\n      return;\n    }\n    this.setBoundsOnFirstLoad = false;\n    this.ctrl.onBoundsChange(this.flattenBounds(moveEvent.target.getBounds(), 'move'));\n  }).bind(this);\n\n  onZoom = ((zoomEvent) => {\n    if (!zoomEvent.target) {\n      return;\n    }\n    this.setBoundsOnFirstLoad = false;\n    this.ctrl.onBoundsChange(this.flattenBounds(zoomEvent.target.getBounds(), 'zoom'));\n  }).bind(this);\n\n  onResize = ((resizeEvent) => {\n    if (!resizeEvent.target) {\n      return;\n    }\n    this.ctrl.onBoundsChange(this.flattenBounds(resizeEvent.target.getBounds(), 'resize'));\n  }).bind(this);\n\n  flattenBounds(bounds, trigger) {\n    if (!bounds) {\n      return {};\n    }\n    const maxChangeDelta = this.calculateMaxChangeDelta(bounds);\n\n    return {\n      nortWest: { lat: bounds.getNorthWest().lat, lng: bounds.getNorthWest().lng},\n      northEast: { lat: bounds.getNorthEast().lat, lng: bounds.getNorthEast().lng},\n      southEast: { lat: bounds.getSouthEast().lat, lng: bounds.getSouthEast().lng},\n      southWest: { lat: bounds.getSouthWest().lat, lng: bounds.getSouthWest().lng},\n      triggeredBy: trigger,\n      maxChangeDelta: maxChangeDelta\n    };\n  }\n\n  calculateMaxChangeDelta(bounds) {\n    let maxChangeDelta = 0;\n    if (this.lastBounds) {\n      const nwDist = window.L.CRS.Simple.distance(bounds.getNorthWest(), this.lastBounds.getNorthWest());\n      if (nwDist > maxChangeDelta) {\n        maxChangeDelta = nwDist;\n      }\n      const neDist = window.L.CRS.Simple.distance(bounds.getNorthEast(), this.lastBounds.getNorthEast());\n      if (neDist > maxChangeDelta) {\n        maxChangeDelta = neDist;\n      }\n      const seDist = window.L.CRS.Simple.distance(bounds.getSouthEast(), this.lastBounds.getSouthEast());\n      if (seDist > maxChangeDelta) {\n        maxChangeDelta = seDist;\n      }\n      const swDist = window.L.CRS.Simple.distance(bounds.getSouthWest(), this.lastBounds.getSouthWest());\n      if (swDist > maxChangeDelta) {\n        maxChangeDelta = swDist;\n      }\n      return maxChangeDelta;\n    }\n    this.lastBounds = bounds;\n  }\n}\n"]}